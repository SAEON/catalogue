FROM node:16.6.1

ARG ELASTICSEARCH_ADDRESS
ENV ELASTICSEARCH_ADDRESS=$ELASTICSEARCH_ADDRESS

ARG LATEST_COMMIT
ENV LATEST_COMMIT=$LATEST_COMMIT

WORKDIR /app
COPY . .
RUN npm ci --legacy-peer-deps --only=production
EXPOSE 8001 8002

CMD ELASTICSEARCH_ADDRESS=$ELASTICSEARCH_ADDRESS \
  LATEST_COMMIT=$LATEST_COMMIT \
  npm run start:prod