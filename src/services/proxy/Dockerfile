FROM node:14.15

ARG ELASTICSEARCH_ADDRESS
ENV ELASTICSEARCH_ADDRESS=$ELASTICSEARCH_ADDRESS

ARG CATALOGUE_LATEST_COMMIT
ENV CATALOGUE_LATEST_COMMIT=$CATALOGUE_LATEST_COMMIT

WORKDIR /app
COPY . .
RUN npm ci --only=production
EXPOSE 8001 8002

CMD ELASTICSEARCH_ADDRESS=$ELASTICSEARCH_ADDRESS \
  CATALOGUE_LATEST_COMMIT=$CATALOGUE_LATEST_COMMIT \
  npm run start:prod