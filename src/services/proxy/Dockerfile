FROM node:14.13

ARG ELASTICSEARCH_PROXY
ENV ELASTICSEARCH_PROXY=$ELASTICSEARCH_PROXY

ARG LATEST_COMMIT
ENV LATEST_COMMIT=$LATEST_COMMIT

WORKDIR /app
COPY . .
RUN npm ci --only=production
EXPOSE 8001 8002

CMD ELASTICSEARCH_PROXY=$ELASTICSEARCH_PROXY \
  LATEST_COMMIT=$LATEST_COMMIT \
  npm run start:prod