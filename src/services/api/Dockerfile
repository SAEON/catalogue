FROM node:14.13

ARG MONGO_USER
ENV MONGO_USER=$MONGO_USER

ARG MONGO_PSWD
ENV MONGO_PSWD=$MONGO_PSWD

ARG POSTGIS_USER
ENV POSTGIS_USER=$POSTGIS_USER

ARG POSTGIS_PSWD
ENV POSTGIS_PSWD=$POSTGIS_PSWD

ARG POSTGIS_FOREIGN_USER
ENV POSTGIS_FOREIGN_USER=$POSTGIS_FOREIGN_USER

ARG POSTGIS_FOREIGN_PASSWORD
ENV POSTGIS_FOREIGN_PASSWORD=$POSTGIS_FOREIGN_PASSWORD

WORKDIR /app
COPY . .
RUN npm ci --only=production
EXPOSE 3000

CMD MONGO_USER=$MONGO_USER \
  MONGO_PSWD=$MONGO_PSWD \
  POSTGIS_USER=$POSTGIS_USER \
  POSTGIS_PSWD=$POSTGIS_PSWD \
  POSTGIS_FOREIGN_USER=$POSTGIS_FOREIGN_USER \
  POSTGIS_FOREIGN_PASSWORD=$POSTGIS_FOREIGN_PASSWORD \
  npm run start:prod